---
phase: 04-integration-commands
plan: 04
type: execute
wave: 2
depends_on: ["04-02"]
files_modified:
  - .opencode/commands/ar-generate.md
  - .opencode/commands/ar-update.md
autonomous: false

must_haves:
  truths:
    - "OpenCode users can run /ar:generate to analyze project"
    - "OpenCode users can run /ar:update to update changed files"
    - "All slash commands work in their respective environments"
  artifacts:
    - path: ".opencode/commands/ar-generate.md"
      provides: "/ar:generate for OpenCode"
      contains: "ar generate"
    - path: ".opencode/commands/ar-update.md"
      provides: "/ar:update for OpenCode"
      contains: "ar update"
  key_links:
    - from: ".opencode/commands/ar-generate.md"
      to: "ar generate CLI"
      via: "bash command"
      pattern: "ar generate"
---

<objective>
Create OpenCode integration files and verify all integrations work correctly.

Purpose: Ensures agents-reverse works across multiple AI coding assistants (Claude Code and OpenCode), fulfilling INT-04 requirement for multi-tool support.

Output:
- `.opencode/commands/ar-generate.md` - Generate command for OpenCode
- `.opencode/commands/ar-update.md` - Update command for OpenCode
- Verified working integration across both environments
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-integration-commands/04-RESEARCH.md
@.planning/phases/04-integration-commands/04-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OpenCode command files</name>
  <files>.opencode/commands/ar-generate.md, .opencode/commands/ar-update.md</files>
  <action>
Create `.opencode/commands/` directory and two command files:

1. `.opencode/commands/ar-generate.md`:
```markdown
---
description: Generate AI-friendly documentation for the entire codebase
agent: build
---

Generate comprehensive documentation for this codebase using agents-reverse.

Run: \`ar generate $ARGUMENTS\`

Arguments supported:
- \`--budget N\` - Override token budget
- \`--dry-run\` - Show plan without writing files
- \`--verbose\` - Show detailed output

After completion, summarize:
- Number of files analyzed
- Token budget used
- Location of generated AGENTS.md files
```

2. `.opencode/commands/ar-update.md`:
```markdown
---
description: Incrementally update documentation for changed files
agent: build
---

Update documentation for files that changed since last run.

Run: \`ar update $ARGUMENTS\`

Arguments supported:
- \`--uncommitted\` - Include staged but uncommitted changes
- \`--dry-run\` - Show plan without writing files
- \`--verbose\` - Show detailed output

After completion, summarize:
- Files updated
- Files unchanged
- Any orphaned docs cleaned up
```

Note: OpenCode uses flat command naming (ar-generate not ar/generate) and different frontmatter (description, agent instead of name, argument-hint).
  </action>
  <verify>
```bash
ls -la .opencode/commands/
cat .opencode/commands/ar-generate.md
```
Files exist with correct OpenCode frontmatter format.
  </verify>
  <done>
Two command files exist in .opencode/commands/ with OpenCode-specific frontmatter
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete AI assistant integration for agents-reverse:

**Claude Code:**
- /ar:generate command (.claude/commands/ar/generate.md)
- /ar:update command (.claude/commands/ar/update.md)
- /ar:init command (.claude/commands/ar/init.md)
- SessionEnd hook (.claude/hooks/ar-session-end.js)
- Hook registration in settings.json

**OpenCode:**
- /ar:generate command (.opencode/commands/ar-generate.md)
- /ar:update command (.opencode/commands/ar-update.md)

**CLI:**
- ar init --integration flag generates integration files for detected environments
  </what-built>
  <how-to-verify>
1. **Verify Claude Code commands appear:**
   - In Claude Code, type `/ar:` and verify generate, update, init appear in autocomplete
   - If commands don't appear, restart Claude Code to reload commands

2. **Test /ar:generate (dry run):**
   - Run `/ar:generate --dry-run`
   - Should show discovery and generation plan without writing files

3. **Test /ar:update (dry run):**
   - Run `/ar:update --dry-run`
   - Should show any pending changes to process

4. **Verify hook registration:**
   - Check `.claude/settings.json` shows SessionEnd hook
   - Hook should be silent (no output) when you end session with no uncommitted changes

5. **Test ar init --integration:**
   - In a test directory with `.claude/` folder: `ar init --integration`
   - Should report creating command files (or skipping if they exist)
  </how-to-verify>
  <resume-signal>Type "approved" if commands work, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Integration complete:
1. Claude Code: `/ar:generate`, `/ar:update`, `/ar:init` commands available
2. OpenCode: `/ar:generate`, `/ar:update` commands available (when using OpenCode)
3. SessionEnd hook registered and triggers on session close (when git changes exist)
4. `ar init --integration` creates integration files for detected environments
</verification>

<success_criteria>
- All Phase 4 requirements met:
  - INT-01: /ar:generate works in Claude Code
  - INT-02: /ar:update works in Claude Code
  - INT-03: SessionEnd hook triggers automatic updates
  - INT-04: OpenCode integration files created (multi-tool support)
- Human verification confirms commands appear and execute correctly
</success_criteria>

<output>
After completion, create `.planning/phases/04-integration-commands/04-04-SUMMARY.md`
</output>
