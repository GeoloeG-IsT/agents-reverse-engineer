---
phase: 01-foundation-discovery
plan: 04
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/config/loader.ts
  - src/output/logger.ts
autonomous: true

must_haves:
  truths:
    - "Config loader reads YAML file and validates with Zod"
    - "Config loader returns defaults when config file missing"
    - "Logger outputs colored text in verbose mode"
    - "Logger suppresses output in quiet mode"
  artifacts:
    - path: "src/config/loader.ts"
      provides: "Configuration loading and validation"
      exports: ["loadConfig"]
    - path: "src/output/logger.ts"
      provides: "Colored terminal output"
      exports: ["createLogger", "Logger"]
  key_links:
    - from: "src/config/loader.ts"
      to: "src/config/schema.ts"
      via: "import ConfigSchema"
      pattern: "import.*ConfigSchema.*schema"
    - from: "src/output/logger.ts"
      to: "picocolors"
      via: "import"
      pattern: "import.*picocolors"
---

<objective>
Create configuration loader and terminal output utilities.

Purpose: The config loader reads `.agents-reverse/config.yaml`, validates it against the Zod schema, and returns a typed config object. The logger provides colored output with verbose/quiet modes per CONTEXT.md decisions.

Output: loadConfig function and createLogger factory ready for CLI use.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-discovery/01-CONTEXT.md
@.planning/phases/01-foundation-discovery/01-RESEARCH.md
@.planning/phases/01-foundation-discovery/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create configuration loader</name>
  <files>src/config/loader.ts</files>
  <action>
Create src/config/loader.ts following RESEARCH.md Pattern 4:

Import { parse } from 'yaml'.
Import { ConfigSchema, Config } from './schema.js'.
Import fs/promises and path.

Define CONFIG_DIR = '.agents-reverse' and CONFIG_FILE = 'config.yaml'.

Export async function loadConfig(root: string): Promise<Config>
- Construct path: path.join(root, CONFIG_DIR, CONFIG_FILE)
- Try to read file
- If ENOENT (file not found): return ConfigSchema.parse({}) (defaults)
- If file exists: parse YAML, validate with ConfigSchema.parse()
- If parse/validation fails: throw descriptive error with file path and Zod error message
- Return validated config

Export async function configExists(root: string): Promise<boolean>
- Check if config file exists
- Used by CLI to determine if init is needed

Export async function writeDefaultConfig(root: string): Promise<void>
- Create .agents-reverse directory if needed
- Write default config.yaml with comments explaining each option
- Use YAML.stringify or template string for pretty output with comments
  </action>
  <verify>
`npm run build` succeeds.
Test: `npx tsx -e "import { loadConfig } from './src/config/loader.js'; loadConfig('.').then(c => console.log(c.exclude.vendorDirs.length))"` outputs a number (defaults loaded since no config exists).
  </verify>
  <done>
Config loader returns validated config. Missing file returns defaults. Invalid YAML throws helpful error.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create terminal logger</name>
  <files>src/output/logger.ts</files>
  <action>
Create src/output/logger.ts following RESEARCH.md terminal output pattern:

Import pc from 'picocolors'.

Export interface Logger:
- info(message: string): void
- file(path: string): void (for verbose file listing)
- excluded(path: string, reason: string, filter: string): void
- summary(included: number, excluded: number): void
- warn(message: string): void
- error(message: string): void

Export interface LoggerOptions:
- verbose: boolean (default true per CONTEXT.md)
- quiet: boolean (default false)
- colors: boolean (default true)
- showExcluded: boolean (default false, only with --show-excluded)

Export function createLogger(options: LoggerOptions): Logger
- If quiet: all methods are no-ops except error
- If not verbose: file() is no-op
- If showExcluded: excluded() logs each excluded file
- If not showExcluded: excluded() is no-op (summary handles count)
- If not colors: use identity functions instead of pc.green, etc.

Output format per CONTEXT.md (human-readable):
- file: green "  +" prefix + relative path
- excluded: dim "  -" prefix + path + reason (when shown)
- summary: bold count + dim excluded count
- warn: yellow "Warning:" prefix
- error: red "Error:" prefix
  </action>
  <verify>
`npm run build` succeeds.
Test: `npx tsx -e "import { createLogger } from './src/output/logger.js'; const log = createLogger({ verbose: true, quiet: false, colors: true, showExcluded: false }); log.file('src/test.ts'); log.summary(10, 5);"` outputs colored text.
  </verify>
  <done>
Logger respects verbose/quiet/colors options. Output is human-readable with appropriate colors.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. loadConfig('.') returns defaults (no config file yet)
3. Logger with quiet: true produces no output for info/file/summary
4. Logger with colors: false produces uncolored output
5. writeDefaultConfig creates .agents-reverse/config.yaml with comments
</verification>

<success_criteria>
- Config loader handles missing file gracefully (returns defaults)
- Config loader validates YAML against Zod schema
- Logger supports verbose/quiet/colors modes per CONTEXT.md
- Logger provides consistent output format for CLI commands
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-discovery/01-04-SUMMARY.md`
</output>
