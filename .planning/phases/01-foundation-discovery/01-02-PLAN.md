---
phase: 01-foundation-discovery
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/discovery/types.ts
  - src/discovery/walker.ts
autonomous: true

must_haves:
  truths:
    - "Walker returns all files in a directory tree"
    - "Walker respects followSymbolicLinks option"
    - "Walker handles permission errors gracefully"
  artifacts:
    - path: "src/discovery/types.ts"
      provides: "Filter interface and discovery types"
      exports: ["FileFilter", "FilterResult"]
    - path: "src/discovery/walker.ts"
      provides: "Directory traversal with fast-glob"
      exports: ["walkDirectory"]
  key_links:
    - from: "src/discovery/walker.ts"
      to: "fast-glob"
      via: "import"
      pattern: "import.*fast-glob"
---

<objective>
Create the file discovery infrastructure - types and directory walker.

Purpose: The walker is the foundation for file discovery. It uses fast-glob to traverse directories and returns all candidate files. Filters (in Plan 03) will then exclude files based on various criteria.

Output: walkDirectory function that returns all files in a directory tree, plus shared types for the filter chain.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-discovery/01-CONTEXT.md
@.planning/phases/01-foundation-discovery/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create discovery types</name>
  <files>src/discovery/types.ts</files>
  <action>
Create src/discovery/types.ts with:

FileFilter interface (from RESEARCH.md Pattern 1):
- name: string (for logging which filter excluded a file)
- shouldExclude(path: string, stats?: Stats): Promise<boolean> | boolean

FilterResult type:
- included: string[] (files that passed all filters)
- excluded: { path: string, reason: string, filter: string }[]

WalkerOptions interface:
- cwd: string (root directory)
- followSymlinks?: boolean (default false per CONTEXT.md)
- dot?: boolean (include dotfiles, default true)

Export all types for use by walker and filters.
  </action>
  <verify>
`npm run build` succeeds with no type errors.
  </verify>
  <done>
Types compile. FileFilter interface ready for implementation by gitignore, binary, vendor, custom filters.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create directory walker using fast-glob</name>
  <files>src/discovery/walker.ts</files>
  <action>
Create src/discovery/walker.ts following RESEARCH.md patterns:

Import fg from 'fast-glob'.
Import WalkerOptions from './types.js'.

Export async function walkDirectory(options: WalkerOptions): Promise<string[]>
- Use fg.glob('**/*', { ... }) with options:
  - cwd: options.cwd
  - absolute: true (return absolute paths)
  - onlyFiles: true
  - dot: options.dot ?? true
  - followSymbolicLinks: options.followSymlinks ?? false
  - suppressErrors: true (per RESEARCH.md: don't throw on permission errors)
  - ignore: ['**/.git/**'] (always exclude .git internals for performance)

Return the array of absolute file paths.

Note: This walker returns ALL files. Filtering happens separately via the filter chain.
  </action>
  <verify>
Create a test by running:
`npx tsx -e "import { walkDirectory } from './src/discovery/walker.js'; walkDirectory({ cwd: '.' }).then(f => console.log(f.length + ' files found'))"`
Should output a number > 0 (finds files in current directory).
  </verify>
  <done>
walkDirectory returns all files in a directory tree. Symlinks are not followed by default. Permission errors are suppressed (empty result for unreadable dirs, not a crash).
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `npx tsx -e "import { walkDirectory } from './src/discovery/walker.js'; walkDirectory({ cwd: '.' }).then(files => { console.log('Found:', files.length); console.log('Sample:', files[0]); })"` shows files with absolute paths
3. Walker does not return .git internal files (e.g., no `.git/objects/...` in results)
</verification>

<success_criteria>
- FileFilter interface defined for filter implementations
- walkDirectory returns absolute paths for all files
- .git internals excluded at walker level for performance
- Symlinks not followed by default
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-discovery/01-02-SUMMARY.md`
</output>
